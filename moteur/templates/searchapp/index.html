<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Moteur de recherche Gutenberg</title>

    <style>
        body {
            font-family: "Georgia", "Garamond", serif;
            background: #f7f2e9 url('https://i.imgur.com/1zQ9ZqR.png');
            background-size: cover;
            padding: 30px;
            color: #2b1d14;
        }

        h1, h2 {
            font-family: "Cinzel", serif;
            text-align: center;
            letter-spacing: 2px;
            color: #3b2a20;
        }

        h1 {
            font-size: 42px;
            border-bottom: 3px solid #4a3427;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        h2 {
            margin-top: 30px;
            font-size: 26px;
        }

        .block {
            margin: 25px auto;
            padding: 20px;
            background: rgba(255, 248, 236, 0.96);
            border-radius: 10px;
            border: 2px solid #3d2c22;
            width: 80%;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }

        form {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 2px solid #3d2c22;
            border-radius: 6px;
            background: #fffaf2;
            font-size: 15px;
        }

        select {
            padding: 8px;
            border: 2px solid #3d2c22;
            border-radius: 6px;
            background: #fffaf2;
            font-family: "Georgia", serif;
        }

        button {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            background: #5e3d2c;
            color: #fcead6;
            font-weight: bold;
            cursor: pointer;
            font-family: "Georgia", serif;
        }

        button:hover {
            background: #40281c;
        }

        ul {
            list-style: none;
            padding: 0;
            width: 80%;
            margin: auto;
        }

        li {
            background: rgba(255, 244, 228, 0.95);
            margin: 8px 0;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #3c281f;
            font-size: 16px;
            font-family: "Georgia", serif;
        }

        .book-header {
            font-weight: bold;
            font-size: 18px;
        }

        .centrality-scores {
            font-size: 14px;
            color: #5a4430;
            margin-top: 5px;
        }

        .score-item {
            display: block;
        }

        .occ {
            font-size: 14px;
            color: #6b4b38;
            margin-top: 5px;
        }

        .btn {
            padding: 6px 12px;
            border-radius: 5px;
            background: #7b4a31;
            color: #fcead6;
            text-decoration: none;
            font-weight: bold;
            border: 1px solid #3b261b;
            margin-top: 5px;
            display: inline-block;
        }

        .btn:hover {
            background: #52301f;
        }
    </style>
</head>

<body>

<h1>⚜️ Moteur de Recherche Gutenberg ⚜️</h1>

{% if graph_stats.nodes > 0 %}
<div class="graph-stats" style="text-align:center; font-style:italic; margin-bottom:20px;">
    Graphe Jaccard: {{ graph_stats.nodes }} livres, {{ graph_stats.edges }} connexions de similarité
</div>
{% endif %}

<!-- Recherche mot-clé -->
<div class="block">
    <h2>Recherche par mot-clé</h2>
    <form method="post">
        {% csrf_token %}
        <input type="text" name="mot" placeholder="Mot indexé" value="{{ keyword_index }}">
        <select name="ranking_method" id="ranking_method_keyword">
            <option value="occurrence" {% if ranking_method == "occurrence" %}selected{% endif %}>Occurrences</option>
            <option value="closeness" {% if ranking_method == "closeness" %}selected{% endif %}>Closeness</option>
        </select>
        <button type="submit">Rechercher</button>
    </form>
</div>

<!-- Recherche regex -->
<div class="block">
    <h2>Recherche avec Regex</h2>
    <form method="post">
        {% csrf_token %}
        <input type="text" name="regex" placeholder="Expression régulière" value="{{ regex_query }}">
        <select name="ranking_method" id="ranking_method_regex">
            <option value="occurrence" {% if ranking_method == "occurrence" %}selected{% endif %}>Occurrences</option>
            <option value="closeness" {% if ranking_method == "closeness" %}selected{% endif %}>Closeness</option>
        </select>
        <button type="submit">Rechercher</button>
    </form>
</div>

<!-- Résultats mot-clé -->
{% if results_index %}
    <h2>Résultats mot-clé :</h2>
    <ul>
    {% for book in results_index %}
        <li>
            <div class="book-header">{{ book.title }}</div>

            {% if ranking_method == "occurrence" %}
                <div class="occ">{{ book.count }} occurrence{{ book.count|pluralize }}</div>
            {% else %}
                <div class="centrality-scores">
                    {% if ranking_method == "closeness" %}<span class="score-item">Closeness: {{ book.centrality_score|floatformat:6 }}</span>{% endif %}
                </div>
            {% endif %}

            <a href="{% url 'display_book' book.id %}" class="btn">Voir</a>
        </li>
    {% endfor %}
    </ul>
{% endif %}

<!-- Résultats regex -->
{% if results_regex %}
    <h2>Résultats Regex :</h2>
    <ul>
    {% for book in results_regex %}
        <li>
            <div class="book-header">{{ book.title }}</div>

            {% if ranking_method == "occurrence" %}
                <div class="occ">{{ book.count }} occurrence{{ book.count|pluralize }}</div>
            {% else %}
                <div class="centrality-scores">
                    {% if ranking_method == "closeness" %}<span class="score-item">Closeness: {{ book.centrality_score|floatformat:6 }}</span>{% endif %}
                </div>
            {% endif %}

            <a href="{% url 'display_book' book.id %}" class="btn">Voir</a>
        </li>
    {% endfor %}
    </ul>
{% endif %}

<!-- Message si recherche sans résultats -->
{% if keyword_index and not results_index and not results_regex %}
    <div class="block">
        <h3>Aucun résultat trouvé pour "{{ keyword_index }}"</h3>
    </div>
{% endif %}

{% if regex_query and not results_regex and not results_index %}
    <div class="block">
        <h3>Aucun résultat trouvé pour "{{ regex_query }}"</h3>
    </div>
{% endif %}

</body>
</html>